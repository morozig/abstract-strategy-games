(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,,,,,,,function(t,e,n){t.exports=n(38)},,,,,function(t,e,n){},function(t,e,n){},function(t,e,n){},,,,,,,function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e,n){},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var r,a=n(1),i=n.n(a),s=n(14),u=n.n(s),o=(n(21),n(22),n(7)),c=(n(23),n(2)),l=n.n(c),p=n(4);!function(t){t[t.Human=0]="Human",t[t.Alpha=1]="Alpha",t[t.Random=2]="Random",t[t.Mcts=3]="Mcts"}(r||(r={}));var h,f,m=n(5),v=n(6),y=function(t,e){var n=function(t,e){var n=e?10:100,r=t.map(function(t){return Math.exp(t*n)}),a=r.reduce(function(t,e){return t+e},0);return r.map(function(t){return t/a})}(t,e),r=Math.random(),a=0,i=0,s=!0,u=!1,o=void 0;try{for(var c,l=n[Symbol.iterator]();!(s=(c=l.next()).done);s=!0){if((a+=c.value)>=r)break;i+=1}}catch(p){u=!0,o=p}finally{try{s||null==l.return||l.return()}finally{if(u)throw o}}return i},d=function(t){return t[Math.floor(Math.random()*t.length)]},b=function(t){return new Promise(function(e){return setTimeout(e,t)})},k=function(){function t(e){Object(m.a)(this,t),this.gameRules=void 0,this.gameState=void 0,this.gameRules=e,this.gameState=e.init()}return Object(v.a)(t,[{key:"act",value:function(){var t=Object(p.a)(l.a.mark(function t(){var e,n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.gameRules.availables(this.gameState),n=d(e),this.step(n),t.abrupt("return",n);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"step",value:function(t){var e=this.gameRules.step(this.gameState,t);this.gameState=e.state}},{key:"init",value:function(){this.gameState=this.gameRules.init()}}]),t}(),w=function(){function t(e){Object(m.a)(this,t),this.humanAction=void 0,this.humanAction=e}return Object(v.a)(t,[{key:"act",value:function(){return this.humanAction()}},{key:"step",value:function(){}},{key:"init",value:function(){}}]),t}(),x=function(t){return function(){var e=Object(p.a)(l.a.mark(function e(n){var r,a,i,s,u,o,c,p,h,f,m,v,y,b,k,w,x,g,E;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=t.init(),a=!1,i=[],s=!0,u=!1,o=void 0,e.prev=6,c=n[Symbol.iterator]();!(s=(p=c.next()).done);s=!0)h=p.value,f=t.step(r,h),r=f.state,a=f.done;e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),u=!0,o=e.t0;case 14:e.prev=14,e.prev=15,s||null==c.return||c.return();case 17:if(e.prev=17,!u){e.next=20;break}throw o;case 20:return e.finish(17);case 21:return e.finish(14);case 22:for(m=r.playerIndex,v=[],y=t.availables(r),b=0;b<t.actionsCount;b++)k=y.includes(b+1)?1/y.length:0,v.push(k);for(;!a;)w=t.availables(r),x=d(w),g=t.step(r,x),r=g.state,a=g.done,i=g.rewards;return E=i[m],e.abrupt("return",{policy:v,reward:E});case 29:case"end":return e.stop()}},e,null,[[6,10,14,22],[15,,17,21]])}));return function(t){return e.apply(this,arguments)}}()},g=function(){function t(e){Object(m.a)(this,t),this.visits=void 0,this.parent=void 0,this.action=void 0,this.prob=void 0,this.stepResult=void 0,this.children=[],this.totalValue=0,this.meanValue=0,this.visits=0,this.parent=e.parent,this.action=e.action,this.prob=e.prob,this.stepResult=e.stepResult}return Object(v.a)(t,[{key:"isLeaf",value:function(){return!this.children.length}},{key:"getBonus",value:function(){var t=this.parent?this.parent.visits:this.visits;return 1*this.prob*Math.sqrt(t)/(this.visits+1)}},{key:"sameAsParent",value:function(){return!!this.parent&&this.parent.stepResult.state.playerIndex===this.stepResult.state.playerIndex}},{key:"findBestLeaf",value:function(){if(this.isLeaf())return this;var t,e=this.children.map(function(t){return(t.sameAsParent()?1:-1)*t.meanValue+t.getBonus()});return this.children[(t=e,t.reduce(function(t,e,n,r){return e>r[t]?n:t},0))].findBestLeaf()}},{key:"getHistory",value:function(){return this.parent?this.parent.getHistory().concat(this.action):[]}},{key:"propagate",value:function(t){if(this.visits+=1,this.totalValue+=t,this.meanValue=this.totalValue/this.visits,this.parent){var e=this.sameAsParent()?1:-1;this.parent.propagate(t*e)}}}]),t}(),E=function(){function t(e){Object(m.a)(this,t),this.gameRules=void 0,this.predict=void 0,this.planCount=void 0,this.randomize=void 0,this.root=void 0,this.rootHistory=void 0,this.gameRules=e.gameRules,this.predict=e.predict?e.predict:x(this.gameRules),this.planCount=e.planCount?e.planCount:100,this.randomize=!!e.randomize,this.root=new g({parent:null,action:0,prob:1,stepResult:{done:!1,rewards:[],state:this.gameRules.init()}}),this.rootHistory=[]}return Object(v.a)(t,[{key:"act",value:function(){var t=Object(p.a)(l.a.mark(function t(){var e,n,r,a=this;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.plan();case 2:return e=this.root.children.map(function(t){return t.visits/a.root.visits}),n=y(e,this.randomize),r=this.root.children[n].action,this.step(r),t.abrupt("return",r);case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"step",value:function(t){var e=this.root.children.find(function(e){return e.action===t});if(e)this.root=e,this.root.parent=null;else{var n=this.gameRules.step(this.root.stepResult.state,t);this.root=new g({parent:null,action:t,prob:1,stepResult:n})}this.rootHistory.push(t)}},{key:"init",value:function(){this.root=new g({parent:null,action:0,prob:1,stepResult:{done:!1,rewards:[],state:this.gameRules.init()}}),this.rootHistory=[]}},{key:"expand",value:function(){var t=Object(p.a)(l.a.mark(function t(e){var n,r,a,i,s,u,o,c,p,h,f,m,v,y;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.rootHistory.concat(e.getHistory()),t.next=3,this.predict(n);case 3:for(r=t.sent,a=r.reward,i=r.policy,s=this.gameRules.availables(e.stepResult.state),u=!0,o=!1,c=void 0,t.prev=10,p=s[Symbol.iterator]();!(u=(h=p.next()).done);u=!0)f=h.value,m=i[f-1],v=this.gameRules.step(e.stepResult.state,f),y=new g({action:f,prob:m,stepResult:v,parent:e}),e.children.push(y);t.next=18;break;case 14:t.prev=14,t.t0=t.catch(10),o=!0,c=t.t0;case 18:t.prev=18,t.prev=19,u||null==p.return||p.return();case 21:if(t.prev=21,!o){t.next=24;break}throw c;case 24:return t.finish(21);case 25:return t.finish(18);case 26:return t.abrupt("return",a);case 27:case"end":return t.stop()}},t,this,[[10,14,18,26],[19,,21,25]])}));return function(e){return t.apply(this,arguments)}}()},{key:"plan",value:function(){var t=Object(p.a)(l.a.mark(function t(){var e,n,r,a;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=0;case 1:if(!(e<this.planCount)){t.next=16;break}if(n=this.root.findBestLeaf(),r=0,!n.stepResult.done){t.next=9;break}a=n.stepResult.rewards[n.stepResult.state.playerIndex],r=a,t.next=12;break;case 9:return t.next=11,this.expand(n);case 11:r=t.sent;case 12:n.propagate(r);case 13:e++,t.next=1;break;case 16:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),t}(),j=function(t,e){var n=!e;return function(){var r=Object(p.a)(l.a.mark(function r(a){return l.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n||!e){r.next=4;break}return r.next=3,t.load(e);case 3:n=!0;case 4:return r.next=6,t.predict(a);case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}},r)}));return function(t){return r.apply(this,arguments)}}()},O=function(){function t(e){Object(m.a)(this,t),this.mcts=void 0,this.mcts=new E({gameRules:e.gameRules,predict:j(e.model,e.url),planCount:e.planCount,randomize:e.randomize})}return Object(v.a)(t,[{key:"act",value:function(){return this.mcts.act()}},{key:"init",value:function(){return this.mcts.init()}},{key:"step",value:function(t){return this.mcts.step(t)}}]),t}(),R=function(t){for(var e=t.game.Component,n=function(t){var e=Object(a.useState)(t.rules.init()),n=Object(o.a)(e,2),i=n[0],s=n[1],u=Object(a.useState)("Choose players and start"),c=Object(o.a)(u,2),h=c[0],f=c[1],m=Object(a.useRef)(!1),v=Object(a.useRef)(null),y=Object(a.useCallback)(function(t){v.current&&(v.current(t),v.current=null)},[]),d=Object(a.useCallback)(function(){return new Promise(function(t){v.current=t})},[]),x=Object(a.useCallback)(function(e){var n=e.map(function(e){switch(e.type){case r.Random:return new k(t.rules);case r.Mcts:return new E({gameRules:t.rules,planCount:e.planCount});case r.Alpha:return new O({gameRules:t.rules,planCount:e.planCount,model:t.createModel(),url:e.url});case r.Human:return new w(d)}return new k(t.rules)}),a=function(){var e=Object(p.a)(l.a.mark(function e(){var r,a,i,u,o,c,p;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.rules.init(),s(r),a=!1,i=[];case 5:if(a||!m.current){e.next=21;break}return f("Player ".concat(r.playerIndex+1,"'s turn")),e.next=9,b(1);case 9:return e.next=11,n[r.playerIndex].act();case 11:for(c in u=e.sent,o=t.rules.step(r,u),n)p=n[c],+c!==r.playerIndex&&p.step(u);r=o.state,s(r),a=o.done,i=o.rewards;case 18:e.next=5;break;case 21:e.t0=i[0],e.next=1===e.t0?24:-1===e.t0?26:28;break;case 24:return f("Player 1 won"),e.abrupt("break",29);case 26:return f("Player 2 won"),e.abrupt("break",29);case 28:f("It's a tie");case 29:m.current=!1;case 30:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();m.current=!0,a()},[t,d]);return{gameState:i,status:h,onAction:y,start:x,stop:Object(a.useCallback)(function(){m.current=!1},[])}}(t.game),s=n.gameState,u=n.status,c=n.onAction,h=n.start,f=n.stop,m=u.includes("turn"),v=t.game.players.find(function(t){return t.type===r.Human})?t.game.players:[{type:r.Human}].concat(t.game.players),y=[0],d=1;d<=1;d++)y.push(v.length-1);var x=Object(a.useState)(y),g=Object(o.a)(x,2),j=g[0],R=g[1];return i.a.createElement("div",{className:"Game"},i.a.createElement("h2",null,t.game.title),i.a.createElement(e,{gameState:s,onAction:c}),i.a.createElement("div",{className:"Game-status"},i.a.createElement("p",{className:"Game-text"},u)),i.a.createElement("div",{className:"Game-controls"},i.a.createElement("div",null,j.map(function(t,e){return i.a.createElement("div",{className:"Game-select",key:e},i.a.createElement("p",{className:"Game-text"},"Player ".concat(e+1,":")),i.a.createElement("select",{value:t,onChange:function(t){var n=+t.target.value;R(function(t){var r=t.slice();return r.splice(e,1,n),r})}},v.map(function(t,e){return i.a.createElement("option",{key:e,value:e},t.name||r[t.type])})))})),m?i.a.createElement("button",{className:"Game-button",onClick:function(t){t.preventDefault(),f()}},i.a.createElement("p",{className:"Game-text"},"Stop")):i.a.createElement("button",{className:"Game-button",onClick:function(t){t.preventDefault(),h(j.map(function(t){return v[t]}))}},i.a.createElement("p",{className:"Game-text"},"Start"))))};(f=h||(h={}))[f.Empty=0]="Empty",f[f.X=1]="X",f[f.O=2]="O";var C=h,S=n(15),A=function(t,e){return t.length<e?0:t.find(function(n,r){if(!n)return!1;var a=t.slice(r,r+e);return a.length===e&&a.every(function(t){return t===n})})||0},z=function(t,e,n){for(var r=[],a=Object(S.a)({},e);void 0!==t[a.i];){var i=t[a.i][a.j];if(void 0===i)break;r.push(i),a={i:a.i+n.i,j:a.j+n.j}}return r},N=function(){function t(){Object(m.a)(this,t),this.actionsCount=7}return Object(v.a)(t,[{key:"step",value:function(t,e){if(!this.availables(t).includes(e))throw new Error("bad action!");var n=function(t){return t.map(function(t){return t.slice()})}(t.board),r=t.playerIndex+1,a=function(t,e){for(var n=e-1,r=5;0!==t[r][n]&&r>=0;)r--;return[r,n]}(n,e),i=Object(o.a)(a,2),s=i[0],u=i[1];n[s][u]=r;var c=function(t,e){var n=t,r=!0,a=!1,i=void 0;try{for(var s,u=n[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var o=s.value,c=A(o,e);if(c)return c}}catch(tt){a=!0,i=tt}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}var l=t[0].length,p=t.length,h=Array.from(Array(l).keys()).map(function(e){return z(t,{i:0,j:e},{i:1,j:0})}),f=!0,m=!1,v=void 0;try{for(var y,d=h[Symbol.iterator]();!(f=(y=d.next()).done);f=!0){var b=y.value,k=A(b,e);if(k)return k}}catch(tt){m=!0,v=tt}finally{try{f||null==d.return||d.return()}finally{if(m)throw v}}var w=Array.from(Array(l).keys()).map(function(e){return z(t,{i:0,j:e},{i:1,j:1})}),x=!0,g=!1,E=void 0;try{for(var j,O=w[Symbol.iterator]();!(x=(j=O.next()).done);x=!0){var R=j.value,C=A(R,e);if(C)return C}}catch(tt){g=!0,E=tt}finally{try{x||null==O.return||O.return()}finally{if(g)throw E}}var S=Array.from(Array(p).keys()).slice(1).map(function(e){return z(t,{i:e,j:0},{i:1,j:1})}),N=!0,I=!1,M=void 0;try{for(var H,P=S[Symbol.iterator]();!(N=(H=P.next()).done);N=!0){var B=H.value,L=A(B,e);if(L)return L}}catch(tt){I=!0,M=tt}finally{try{N||null==P.return||P.return()}finally{if(I)throw M}}var G=Array.from(Array(l).keys()).map(function(e){return z(t,{i:0,j:e},{i:1,j:-1})}),D=!0,F=!1,q=void 0;try{for(var U,V=G[Symbol.iterator]();!(D=(U=V.next()).done);D=!0){var X=U.value,T=A(X,e);if(T)return T}}catch(tt){F=!0,q=tt}finally{try{D||null==V.return||V.return()}finally{if(F)throw q}}var W=Array.from(Array(p).keys()).slice(1).map(function(e){return z(t,{i:e,j:l-1},{i:1,j:-1})}),J=!0,$=!1,K=void 0;try{for(var Q,Y=W[Symbol.iterator]();!(J=(Q=Y.next()).done);J=!0){var Z=Q.value,_=A(Z,e);if(_)return _}}catch(tt){$=!0,K=tt}finally{try{J||null==Y.return||Y.return()}finally{if($)throw K}}return 0}(n,4),l=!!c||0===this.availables({board:n,playerIndex:-1}).length,p=[0,0];return c&&(p[t.playerIndex]=1,p[1-t.playerIndex]=-1),{done:l,rewards:p,state:{board:n,playerIndex:l?t.playerIndex:1-t.playerIndex}}}},{key:"availables",value:function(t){for(var e=[],n=t.board,r=0;r<7;r++)n[0][r]===C.Empty&&e.push(r+1);return e}},{key:"init",value:function(){return{board:[[C.Empty,C.Empty,C.Empty,C.Empty,C.Empty,C.Empty,C.Empty],[C.Empty,C.Empty,C.Empty,C.Empty,C.Empty,C.Empty,C.Empty],[C.Empty,C.Empty,C.Empty,C.Empty,C.Empty,C.Empty,C.Empty],[C.Empty,C.Empty,C.Empty,C.Empty,C.Empty,C.Empty,C.Empty],[C.Empty,C.Empty,C.Empty,C.Empty,C.Empty,C.Empty,C.Empty],[C.Empty,C.Empty,C.Empty,C.Empty,C.Empty,C.Empty,C.Empty]],playerIndex:0}}}]),t}(),I=n(3),M=function(t){var e=I.b.conv2d({kernelSize:3,filters:70,strides:1,padding:"same"}).apply(t);return e=I.b.batchNormalization().apply(e),e=I.b.leakyReLU().apply(e),e=I.b.conv2d({kernelSize:3,filters:70,strides:1,padding:"same"}).apply(t),e=I.b.batchNormalization().apply(e),e=I.b.add().apply([e,t]),e=I.b.leakyReLU().apply(e)},H=function(){function t(e){Object(m.a)(this,t),this.model=void 0,this.historyDepth=void 0,this.useColor=void 0,this.historyDepth=e.historyDepth,this.useColor=e.useColor,this.model=this.createModel(),this.compile()}return Object(v.a)(t,[{key:"fit",value:function(){var t=Object(p.a)(l.a.mark(function t(e,n){var r,a,i,s,u,o;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=I.f(e),a=I.e(n.map(function(t){return t[0]})),i=I.e(n.map(function(t){return t[1]})),s=[a,i],t.next=6,this.model.fit(r,s,{batchSize:128,epochs:40,shuffle:!0,callbacks:{onEpochEnd:console.log}});case 6:return u=t.sent,r.dispose(),a.dispose(),i.dispose(),console.log(u),o=u.history.loss[39],t.abrupt("return",o);case 13:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()},{key:"predict",value:function(){var t=Object(p.a)(l.a.mark(function t(e){var n,r,a,i,s,u,c,p;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=I.f(e),r=this.model.predict(n),a=Object(o.a)(r,2),i=a[0],s=a[1],t.next=4,i.array();case 4:return u=t.sent,t.next=7,s.array();case 7:return c=t.sent,n.dispose(),i.dispose(),s.dispose(),p=u.map(function(t,e){return[t,c[e]]}),t.abrupt("return",p);case 13:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"save",value:function(){var t=Object(p.a)(l.a.mark(function t(e){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.model.save(e);case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"load",value:function(){var t=Object(p.a)(l.a.mark(function t(e){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I.c(e);case 2:this.model=t.sent,this.compile();case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"compile",value:function(){var t=I.g.sgd(.1);this.model.compile({optimizer:t,loss:["categoricalCrossentropy","categoricalCrossentropy"],metrics:["accuracy"]})}},{key:"createModel",value:function(){var t=this.useColor?1:0,e=2*this.historyDepth+t;console.log(e);var n=I.a({shape:[6,7,e]}),r=n;r=I.b.conv2d({kernelSize:3,filters:70,padding:"same",strides:1}).apply(r),r=I.b.batchNormalization().apply(r),r=I.b.leakyReLU().apply(r);for(var a=0;a<1;a++)r=M(r);var i=I.b.conv2d({kernelSize:1,filters:2,strides:1,padding:"same"}).apply(r);i=I.b.batchNormalization().apply(i),i=I.b.leakyReLU().apply(i),i=I.b.maxPooling2d({poolSize:[6,1]}).apply(i),i=I.b.batchNormalization().apply(i),i=I.b.flatten().apply(i),i=I.b.dense({units:7}).apply(i),i=I.b.softmax().apply(i);var s=I.b.conv2d({kernelSize:1,filters:1,strides:1,padding:"same"}).apply(r);return s=I.b.batchNormalization().apply(s),s=I.b.leakyReLU().apply(s),s=I.b.flatten().apply(s),s=I.b.dense({units:20}).apply(s),s=I.b.batchNormalization().apply(s),s=I.b.leakyReLU().apply(s),s=I.b.dense({units:3}).apply(s),s=I.b.softmax().apply(s),I.d({inputs:n,outputs:[i,s]})}}]),t}(),P=function(){function t(e,n,r){Object(m.a)(this,t),this.func=void 0,this.size=void 0,this.wait=void 0,this.onFull=null,this.queue=[],this.func=e,this.size=n,this.wait=r}return Object(v.a)(t,[{key:"batchFull",value:function(){var t=this;return new Promise(function(e){t.onFull=e})}},{key:"callBatch",value:function(){var t=Object(p.a)(l.a.mark(function t(){var e,n,r;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.race([b(this.wait),this.batchFull()]);case 2:return e=this.queue.slice(),this.queue=[],this.onFull=null,n=e.map(function(t){return t.input}),t.next=8,this.func(n);case 8:r=t.sent,e.forEach(function(t,e){t.resolve(r[e])});case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"add",value:function(t){this.queue.push(t),1===this.queue.length&&this.callBatch(),this.queue.length===this.size&&this.onFull&&this.onFull()}},{key:"call",value:function(t){var e=this;return new Promise(function(n){var r={input:t,resolve:n};e.add(r)})}}]),t}(),B=2,L=!0,G=function(t){for(var e=t[t.length-1],n=e.playerIndex,r=1-n,a=0===n?C.X:C.O,i=1===n?C.X:C.O,s=[],u=function(e){s.push([]);for(var u=function(u){s[e].push([]);var o=1-n,c=t.filter(function(t){return t.playerIndex===r}).map(function(t){return t.board[e][u]===a?1:0}).reverse().slice(0,B),l=t.filter(function(t){return t.playerIndex===n}).map(function(t){return t.board[e][u]===i?1:0}).reverse().slice(0,B),p=[],h=[],f=Math.max(B-c.length,0),m=Math.max(B-l.length,0);if(f)for(var v=0;v<f;v++)p.push(0);if(m)for(var y=0;y<m;y++)h.push(0);s[e][u]=c.concat(p,l,h,L?[o]:[])},o=0;o<7;o++)u(o)},o=0;o<6;o++)u(o);var c=e.board.map(function(t){return t.join("")}).join("");return{input:s,hash:c}},D=function(t){var e=[t];return e.push(t.map(function(t){return 8-t})),e},F=function(t,e){var n=e.init(),r=[n],a=n,i=!0,s=!1,u=void 0;try{for(var o,c=t[Symbol.iterator]();!(i=(o=c.next()).done);i=!0){var l=o.value,p=e.step(a,l).state;r.push(p),a=p}}catch(h){s=!0,u=h}finally{try{i||null==c.return||c.return()}finally{if(s)throw u}}return r},q=function(t,e){for(var n=[],r=[],a=0;a<7;a++)n[a]=0;for(var i=0;i<3;i++)r[i]=0;return n[e-1]=1,r[t+1]=1,[n,r]},U=function(t){return function(e){return t.predict(e)}},V=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(m.a)(this,t),this.rules=void 0,this.network=void 0,this.gameName=void 0,this.batcher=null,this.gameName=e,this.rules=n,this.network=new H({historyDepth:B,useColor:L}),r&&(this.batcher=new P(U(this.network),100,10))}return Object(v.a)(t,[{key:"train",value:function(){var t=Object(p.a)(l.a.mark(function t(e){var n,r,a,i,s,u,o,c,p,h,f,m,v,y,d,b,k,w,x,g,E,j,O,R,C,S,A;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=[],r=[],a=[],i=!0,s=!1,u=void 0,t.prev=6,o=e[Symbol.iterator]();case 8:if(i=(c=o.next()).done){t.next=33;break}for(p=c.value,h=D(p.history),f=!0,m=!1,v=void 0,t.prev=14,y=h[Symbol.iterator]();!(f=(d=y.next()).done);f=!0)for(b=d.value,(k=F(b,this.rules)).pop(),w=0;w<k.length;w++)x=k.slice(0,w+1),g=G(x),E=g.input,j=k[w],O=j.playerIndex,R=p.rewards[O],C=p.history[w],S=q(R,C),a.push({input:E,output:S});t.next=22;break;case 18:t.prev=18,t.t0=t.catch(14),m=!0,v=t.t0;case 22:t.prev=22,t.prev=23,f||null==y.return||y.return();case 25:if(t.prev=25,!m){t.next=28;break}throw v;case 28:return t.finish(25);case 29:return t.finish(22);case 30:i=!0,t.next=8;break;case 33:t.next=39;break;case 35:t.prev=35,t.t1=t.catch(6),s=!0,u=t.t1;case 39:t.prev=39,t.prev=40,i||null==o.return||o.return();case 42:if(t.prev=42,!s){t.next=45;break}throw u;case 45:return t.finish(42);case 46:return t.finish(39);case 47:return a.forEach(function(t){n.push(t.input),r.push(t.output)}),console.log("training data length: ".concat(n.length)),t.next=51,this.network.fit(n,r);case 51:return A=t.sent,t.abrupt("return",A<.5);case 53:case"end":return t.stop()}},t,this,[[6,35,39,47],[14,18,22,30],[23,,25,29],[40,,42,46]])}));return function(e){return t.apply(this,arguments)}}()},{key:"save",value:function(){var t=Object(p.a)(l.a.mark(function t(e){var n,r;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=window.location,r="".concat(n,"api/").concat(this.gameName,"/model/").concat(e),t.next=4,this.network.save(r);case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"load",value:function(){var t=Object(p.a)(l.a.mark(function t(e){var n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.startsWith("http")?e:"".concat(window.location,"api/").concat(this.gameName)+"/model/".concat(e,"/model.json"),console.log(n),t.next=4,this.network.load(n);case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"predict",value:function(){var t=Object(p.a)(l.a.mark(function t(e){var n,r,a,i,s,u,c,p,h,f,m;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=F(e,this.rules),r=G(n),a=r.input,this.batcher){t.next=10;break}return t.next=5,this.network.predict([a]);case 5:s=t.sent,u=Object(o.a)(s,1),i=u[0],t.next=13;break;case 10:return t.next=12,this.batcher.call(a);case 12:i=t.sent;case 13:return c=i,p=Object(o.a)(c,2),h=p[0],f=p[1],m=f.reduce(function(t,e,n){return t+e*(n-1)},0),t.abrupt("return",{reward:m,policy:h});case 16:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),t}(),X=(n(36),n(37),function(t){return i.a.createElement("svg",{viewBox:"0 0 10 10",x:t.x,y:t.y,width:10,height:10},i.a.createElement("circle",{cx:5,cy:5,r:3.5,className:"Tile Tile--".concat(C[t.tile]),onClick:function(e){e.preventDefault(),t.onClick()}}))}),T=function(t){var e=t.gameState;return i.a.createElement("svg",{className:"Component",viewBox:"0 0 70 60"},i.a.createElement("rect",{x:0,y:0,width:70,height:60,rx:2,ry:2,className:"Background"}),e.board.map(function(e,n){return e.map(function(e,r){return i.a.createElement(X,{key:6*n+r,tile:e,x:10*r,y:10*n,onClick:function(){var e=r+1;t.onAction(e)}})})}))},W=function(){function t(){Object(m.a)(this,t),this.name="four-row",this.title="Four In A Row",this.rules=new N,this.Component=T,this.players=[{type:r.Random},{type:r.Mcts,planCount:5e3},{type:r.Alpha,planCount:300,url:"https://github.com/morozig/abstract-strategy-games/releases/download/alpha-14/model.json"}]}return Object(v.a)(t,[{key:"createModel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new V(this.name,this.rules,t)}}]),t}(),J=function(){var t=Object(a.useRef)(new W);return i.a.createElement("div",{className:"App"},i.a.createElement(R,{game:t.current}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(i.a.createElement(J,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}],[[16,1,2]]]);
//# sourceMappingURL=main.538c0e72.chunk.js.map